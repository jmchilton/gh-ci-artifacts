version: '3.8'
services:
  generate:
    build: .
    volumes:
      - ../../generated/rust:/output
    command: /bin/sh -c "
      echo 'Running cargo test (text output)...' &&
      cargo test > /output/cargo-test-output.txt 2>&1 || true &&
      echo 'Running clippy (JSON)...' &&
      cargo clippy --message-format=json > /output/clippy-output.json 2>&1 || true &&
      echo 'Running clippy (text)...' &&
      cargo clippy > /output/clippy-output.txt 2>&1 || true &&
      echo 'Running rustfmt check (diff)...' &&
      cargo fmt -- --check > /output/rustfmt-output.txt 2>&1 || true &&
      echo 'Rust artifact generation complete!'
      "
